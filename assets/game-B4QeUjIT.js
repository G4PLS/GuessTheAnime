import{a as o,p as s,w as F}from"./chunk-PVWAREVJ-C6codAFB.js";import{d as l}from"./database-D5w6OURp.js";function T({animeList:v,currentAnime:y,gameState:M,guess:g}){const[m,d]=o.useState(""),[f,a]=o.useState([]),j=i=>{const x=i.target.value;if(d(x),!x){a([]);return}const N=v.filter(h=>(h.media.title.english??h.media.title.romaji??"").toLowerCase().includes(x.toLowerCase()));a(N.slice(0,5))},e=i=>{d(i),a([])},w=async()=>{m.trim()!==""&&(await g(m.trim()),d(""),a([]))};return s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("label",{className:"font-semibold",children:"Your Guess:"}),s.jsx("input",{type:"text",value:m,onChange:j,placeholder:"Type anime title...",className:"border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-400"}),f.length>0&&s.jsx("ul",{className:"border border-gray-300 rounded-md bg-gray-750 mt-1 max-h-40 overflow-y-auto shadow-sm",children:f.map(i=>s.jsx("li",{className:"p-2 hover:bg-blue-100 cursor-pointer",onClick:()=>e(i.media.title.english??i.media.title.romaji??""),children:i.media.title.english??i.media.title.romaji},i.id))}),s.jsx("button",{onClick:w,className:"mt-2 bg-blue-500 text-white font-semibold px-4 py-2 rounded-md hover:bg-blue-600 transition-colors",children:"Guess"})]})}const H=F(function(){var D,I,L,C,R,A,E,S;const[y,M]=o.useState(null),[g,m]=o.useState([]),[d,f]=o.useState([]),[a,j]=o.useState(null),[e,w]=o.useState(null);function i(){return!!e&&!!y&&!!g}async function x(){const t=await l.settings.get("current");if(!t)return;const r=await l.getGuessedMediaDtos(),c=await l.getRemainingMediaDtosByListNames(t.selectedLists),n=await l.getGameStateDto();console.log(n),M(t),m(c),f(r),n&&n.guessingMedia?j(await l.getMediaDto(n.guessingMedia.id)):await b()}async function N(t){if(!(!i()||!a))if(a.media.title.english===t&&e.attempts<=6){const r=await k(t);await G(r),await b()}else e.attempts>6?(await G(!1),await b()):h({attempts:e.attempts+1})}function h(t){w(r=>{const n={...r??{attempts:0,review:!1,studio:!1,genres:!1,format:!1,release:!1,tags:!1,similar:!1,guessingMedia:null},...t},p=["format","genres","release","review","similar","studio","tags"];p.forEach(u=>{n[u]=!1});for(let u=0;u<n.attempts&&u<p.length;u++)n[p[u]]=!0;return n})}async function k(t){return t!=="A"}async function G(t){a&&await l.guesses.add({mediaListId:a.mediaList.id,mediaEntryId:a.id,correct:t,attempts:e.attempts,id:d.length+1})}async function b(){const t=await l.settings.get("current");if(!t)return;const r=await l.getGuessedMediaDtos(),c=await l.getRemainingMediaDtosByListNames(t.selectedLists);f(r),m(c);const n=Math.floor(Math.random()*c.length),p=c[n];j(p)}return o.useEffect(()=>{x()},[]),o.useEffect(()=>{h({guessingMedia:a?{id:a.id,media:a.media,score:a.score,scoreFormat:a.scoreFormat}:null,attempts:0,format:!1,genres:!1,release:!1,review:!1,similar:!1,studio:!1,tags:!1})},[a]),s.jsx("div",{className:"flex items-center justify-center h-full bg-gray-800",children:s.jsxs("div",{className:"flex flex-col gap-6 p-6 bg-gray-500 rounded-lg shadow-md w-96 h-[700px]",children:[s.jsxs("h2",{className:"text-2xl font-bold mb-4 text-center",children:["GAME (",d.length,"/",g.length+d.length,")"]}),s.jsx("div",{className:"mb-2",children:s.jsxs("label",{className:"font-semibold",children:[(a==null?void 0:a.media.title.english)||"No Anime"," ",s.jsxs("span",{className:"text-gray-400",children:["(",(a==null?void 0:a.id)||"",")"]})]})}),s.jsxs("div",{className:"mb-4",children:[s.jsx("span",{className:"font-medium",children:"Attempts:"})," ",s.jsx("span",{className:"text-yellow-300",children:(e==null?void 0:e.attempts)??0})]}),s.jsxs("div",{className:"flex flex-col gap-3 overflow-y-auto",children:[s.jsx("h2",{className:"text-xl font-semibold mb-2",children:"HINTS"}),s.jsxs("label",{className:"flex gap-2 items-center",children:[s.jsx("span",{className:"font-medium",children:"Review:"})," ",e!=null&&e.review?((D=e.guessingMedia)==null?void 0:D.media.reviews.nodes[0].summary)??"No review":""]}),s.jsxs("label",{className:"flex gap-2 items-center",children:[s.jsx("span",{className:"font-medium",children:"Studio:"})," ",e!=null&&e.studio?((L=(I=e.guessingMedia)==null?void 0:I.media.studios.edges.find(t=>t.isMain))==null?void 0:L.node.name)??"Unknown":""]}),s.jsxs("label",{className:"flex gap-2 items-center",children:[s.jsx("span",{className:"font-medium",children:"Genres:"})," ",e!=null&&e.genres?(C=e.guessingMedia)==null?void 0:C.media.genres.join(", "):""]}),s.jsxs("label",{className:"flex gap-2 items-center",children:[s.jsx("span",{className:"font-medium",children:"Format:"})," ",e!=null&&e.format?(R=e.guessingMedia)==null?void 0:R.media.format:""]}),s.jsxs("label",{className:"flex gap-2 items-center",children:[s.jsx("span",{className:"font-medium",children:"Release:"})," ",e!=null&&e.release?(A=e.guessingMedia)==null?void 0:A.media.seasonYear:""]}),s.jsxs("label",{className:"flex gap-2 items-center",children:[s.jsx("span",{className:"font-medium",children:"Tags:"})," ",e!=null&&e.tags?(E=e.guessingMedia)==null?void 0:E.media.tags.map(t=>t.name).join(", "):""]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("span",{className:"font-medium",children:"Similar:"}),(e==null?void 0:e.similar)&&s.jsx("div",{className:"flex flex-wrap gap-2",children:(S=e.guessingMedia)==null?void 0:S.media.recommendations.nodes.slice(0,5).map(t=>s.jsx("img",{src:t.mediaRecommendation.coverImage.medium||"",alt:t.mediaRecommendation.coverImage.medium||"",className:"w-16 h-24 object-cover rounded-md shadow-sm"},t.mediaRecommendation.coverImage.medium))})]})]}),s.jsx("div",{className:"mt-4",children:s.jsx(T,{animeList:g,currentAnime:a,gameState:e,guess:N})})]})})});export{H as default};
