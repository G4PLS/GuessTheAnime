import{a as d,p as s,w as R}from"./chunk-PVWAREVJ-C6codAFB.js";import{d as o}from"./database-D5w6OURp.js";function I({animeList:v,currentAnime:y,gameState:M,guess:g}){const[m,r]=d.useState(""),[f,t]=d.useState([]),j=i=>{const x=i.target.value;if(r(x),!x){t([]);return}const N=v.filter(h=>(h.media.title.english??h.media.title.romaji).toLowerCase().includes(x.toLowerCase()));t(N.slice(0,5))},e=i=>{r(i),t([])},w=async()=>{m.trim()!==""&&(await g(m.trim()),r(""),t([]))};return s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("label",{className:"font-semibold",children:"Your Guess:"}),s.jsx("input",{type:"text",value:m,onChange:j,placeholder:"Type anime title...",className:"border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-400"}),f.length>0&&s.jsx("ul",{className:"border border-gray-300 rounded-md bg-gray-750 mt-1 max-h-40 overflow-y-auto shadow-sm",children:f.map(i=>s.jsx("li",{className:"p-2 hover:bg-blue-100 cursor-pointer",onClick:()=>e(i.media.title.english??i.media.title.romaji),children:i.media.title.english??i.media.title.romaji},i.id))}),s.jsx("button",{onClick:w,className:"mt-2 bg-blue-500 text-white font-semibold px-4 py-2 rounded-md hover:bg-blue-600 transition-colors",children:"Guess"})]})}const E=R(function(){var D,L;const[y,M]=d.useState(null),[g,m]=d.useState([]),[r,f]=d.useState([]),[t,j]=d.useState(null),[e,w]=d.useState(null);function i(){return!!e&&!!y&&!!g}async function x(){const a=await o.settings.get("current");if(!a)return;const l=await o.getGuessedMediaDtos(),c=await o.getRemainingMediaDtosByListNames(a.selectedLists),n=await o.getGameStateDto();console.log(n),M(a),m(c),f(l),n&&n.guessingMedia?j(await o.getMediaDto(n.guessingMedia.id)):await b()}async function N(a){if(!(!i()||!t))if(t.media.title.english===a&&e.attempts<=6){const l=await C(a);await G(l),await b()}else e.attempts>6?(await G(!1),await b()):h({attempts:e.attempts+1})}function h(a){w(l=>{const n={...l??{attempts:0,review:!1,studio:!1,genres:!1,format:!1,release:!1,tags:!1,similar:!1,guessingMedia:null},...a},p=["format","genres","release","review","similar","studio","tags"];p.forEach(u=>{n[u]=!1});for(let u=0;u<n.attempts&&u<p.length;u++)n[p[u]]=!0;return n})}async function C(a){return a!=="A"}async function G(a){t&&await o.guesses.add({mediaListId:t.mediaList.id,mediaEntryId:t.id,correct:a,attempts:e.attempts,id:r.length+1})}async function b(){const a=await o.settings.get("current");if(!a)return;const l=await o.getGuessedMediaDtos(),c=await o.getRemainingMediaDtosByListNames(a.selectedLists);f(l),m(c);const n=Math.floor(Math.random()*c.length),p=c[n];j(p)}return d.useEffect(()=>{x()},[]),d.useEffect(()=>{h({guessingMedia:t?{id:t.id,media:t.media,score:t.score,scoreFormat:t.scoreFormat}:null,attempts:0,format:!1,genres:!1,release:!1,review:!1,similar:!1,studio:!1,tags:!1})},[t]),s.jsx("div",{className:"flex items-center justify-center h-full bg-gray-800",children:s.jsxs("div",{className:"flex flex-col gap-6 p-6 bg-gray-500 rounded-lg shadow-md w-96 h-[700px]",children:[s.jsxs("h2",{className:"text-2xl font-bold mb-4 text-center",children:["GAME (",r.length,"/",g.length+r.length,")"]}),s.jsx("div",{className:"mb-2",children:s.jsxs("label",{className:"font-semibold",children:[(t==null?void 0:t.media.title.english)||"No Anime"," ",s.jsxs("span",{className:"text-gray-400",children:["(",(t==null?void 0:t.id)||"",")"]})]})}),s.jsxs("div",{className:"mb-4",children:[s.jsx("span",{className:"font-medium",children:"Attempts:"})," ",s.jsx("span",{className:"text-yellow-300",children:(e==null?void 0:e.attempts)??0})]}),s.jsxs("div",{className:"flex flex-col gap-3 overflow-y-auto",children:[s.jsx("h2",{className:"text-xl font-semibold mb-2",children:"HINTS"}),s.jsxs("label",{className:"flex gap-2 items-center",children:[s.jsx("span",{className:"font-medium",children:"Review:"})," ",e!=null&&e.review?((D=e.guessingMedia.media.reviews.nodes[0])==null?void 0:D.body)??"No review":""]}),s.jsxs("label",{className:"flex gap-2 items-center",children:[s.jsx("span",{className:"font-medium",children:"Studio:"})," ",e!=null&&e.studio?((L=e.guessingMedia.media.studios.edges.find(a=>a.isMain))==null?void 0:L.node.name)??"Unknown":""]}),s.jsxs("label",{className:"flex gap-2 items-center",children:[s.jsx("span",{className:"font-medium",children:"Genres:"})," ",e!=null&&e.genres?e.guessingMedia.media.genres.join(", "):""]}),s.jsxs("label",{className:"flex gap-2 items-center",children:[s.jsx("span",{className:"font-medium",children:"Format:"})," ",e!=null&&e.format?e.guessingMedia.media.format:""]}),s.jsxs("label",{className:"flex gap-2 items-center",children:[s.jsx("span",{className:"font-medium",children:"Release:"})," ",e!=null&&e.release?e.guessingMedia.media.seasonYear:""]}),s.jsxs("label",{className:"flex gap-2 items-center",children:[s.jsx("span",{className:"font-medium",children:"Tags:"})," ",e!=null&&e.tags?e.guessingMedia.media.tags.map(a=>a.name).join(", "):""]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("span",{className:"font-medium",children:"Similar:"}),(e==null?void 0:e.similar)&&s.jsx("div",{className:"flex flex-wrap gap-2",children:e.guessingMedia.media.recommendations.nodes.slice(0,5).map(a=>{var l;return s.jsx("img",{src:a.mediaRecommendation.coverImage.medium,alt:((l=a.mediaRecommendation.title)==null?void 0:l.english)??"Similar",className:"w-16 h-24 object-cover rounded-md shadow-sm"},a.mediaRecommendation.id)})})]})]}),s.jsx("div",{className:"mt-4",children:s.jsx(I,{animeList:g,currentAnime:t,gameState:e,guess:N})})]})})});export{E as default};
